#macro(getMessage $code)$messageSource.getMessage($code, null, $locale)#end
#macro(getPrecision)$cfgSvc.getIntSetting("query", "floating_point_precision", 0)#end

<form>
  <view>
    <name>Participant</name>
    <caption>#getMessage("participant")</caption>
    <table>OS_CPR_RECS</table>
    <primaryKey>CPR_ID</primaryKey>
    <activeCondition>ACTIVITY_STATUS != 'Disabled'</activeCondition>  
    <row>
      <numberField>
        <name>participantId</name>
        <udn>participantId</udn>
        <caption>#getMessage("participant_id")</caption>
        <column>PARTICIPANT_ID</column>
      </numberField>
    </row>
    <row>
      <textField>
        <name>firstName</name>
        <udn>firstName</udn>
        <caption>#getMessage("participant_first_name")</caption>
        <column>FIRST_NAME</column>
        <phi>true</phi>
      </textField>

      <textField>
        <name>middleName</name>
        <udn>middleName</udn>
        <caption>#getMessage("participant_middle_name")</caption>
        <column>MIDDLE_NAME</column>
        <phi>true</phi>
      </textField>

      <textField>
        <name>lastName</name>
        <udn>lastName</udn>
        <caption>#getMessage("participant_last_name")</caption>
        <column>LAST_NAME</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <textField>
        <name>emailAddress</name>
        <udn>emailAddress</udn>
        <caption>#getMessage("participant_email_address")</caption>
        <column>EMAIL_ADDRESS</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <booleanCheckBox>
        <name>emailOptIn</name>
        <udn>emailOptIn</udn>
        <caption>#getMessage("participant_email_opt_in")</caption>
        <column>EMAIL_OPT_IN</column>
      </booleanCheckBox>
    </row>
    <row>
      <textField>
        <name>phoneNumber</name>
        <udn>phoneNumber</udn>
        <caption>#getMessage("participant_phone_number")</caption>
        <column>PHONE_NUMBER</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <booleanCheckBox>
        <name>textOptIn</name>
        <udn>textOptIn</udn>
        <caption>#getMessage("participant_text_opt_in")</caption>
        <column>TEXT_OPT_IN</column>
      </booleanCheckBox>
    </row>
    <row>
      <booleanCheckBox>
        <name>textOptInConsent</name>
        <udn>textOptInConsent</udn>
        <caption>#getMessage("participant_text_opt_in_consent")</caption>
        <column>TEXT_OPT_IN_CONSENT</column>
      </booleanCheckBox>
    </row>
    <row>
      <datePicker>
        <name>dateOfBirth</name>
        <udn>dateOfBirth</udn>
        <caption>#getMessage("participant_dob")</caption>
        <column>DOB</column>
        <format>MM-dd-yyyy/dateOnly</format>
        <phi>true</phi>
      </datePicker>
    </row>
    <row>
      <datePicker>
        <name>deathDate</name>
        <udn>deathDate</udn>
        <caption>#getMessage("participant_death_date")</caption>
        <column>DEATH_DATE</column>
        <format>MM-dd-yyyy/dateOnly</format>
        <phi>true</phi>
      </datePicker>
    </row>
    <row>
      <textField>
        <name>ssn</name>
        <udn>ssn</udn>
        <caption>#getMessage("participant_ssn")</caption>
        <column>SSN</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <textField>
        <name>empi</name>
        <udn>empi</udn>
        <caption>#getMessage("participant_empi")</caption>
        <column>EMPI_ID</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <pvField>
        <name>vitalStatus</name>
        <udn>vitalStatus</udn>
        <caption>#getMessage("participant_vital_status")</caption>
        <column>VITAL_STATUS_ID</column>
        <attribute>vital_status</attribute>
      </pvField>
    </row>
    <row>
      <dropDown>
        <name>activityStatus</name>
        <udn>activityStatus</udn>
        <caption>#getMessage("participant_activity_status")</caption>
        <column>ACTIVITY_STATUS</column>
        <options>
          <option><value>Active</value></option>
          <option><value>Closed</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <dropDown>
        <name>dataEntryStatus</name>
        <udn>dataEntryStatus</udn>
        <caption>#getMessage("common_data_entry_status")</caption>
        <column>DATA_ENTRY_STATUS</column>
        <options>
          <option><value>COMPLETE</value></option>
          <option><value>DRAFT</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <pvField>
        <name>gender</name>
        <udn>gender</udn>
        <caption>#getMessage("participant_gender")</caption>
        <column>GENDER_ID</column>
        <attribute>gender</attribute>
      </pvField>
    </row>
    <row>
      <pvField>
        <name>race</name>
        <udn>race</udn>
        <caption>#getMessage("participant_race")</caption>
        <multiple>true</multiple>
        <parentKey>PARTICIPANT_ID</parentKey>
        <collectionTable>CATISSUE_RACE</collectionTable>
        <collectionKey>PARTICIPANT_ID</collectionKey>
        <column>RACE_ID</column>
        <attribute>race</attribute>
      </pvField>
    </row>
    <row>
      <pvField>
        <name>ethnicity</name>
        <udn>ethnicity</udn>
        <caption>#getMessage("participant_ethnicity")</caption>
        <multiple>true</multiple>
        <parentKey>PARTICIPANT_ID</parentKey>
        <collectionTable>OS_PARTICIPANT_ETHNICITIES</collectionTable>
        <collectionKey>PARTICIPANT_ID</collectionKey>
        <column>ETHNICITY_ID</column>
        <attribute>ethnicity</attribute>
      </pvField>
    </row>
    <row>
      <subForm>
        <name>medicalRecord</name>
        <udn>medicalRecord</udn>
        <caption>#getMessage("participant_mrn")</caption>
        <table>CATISSUE_PART_MEDICAL_ID</table>
        <foreignKey>PARTICIPANT_ID</foreignKey>
        <parentKey>PARTICIPANT_ID</parentKey>
        <row>
          <numberField>
            <name>mrnSiteId</name>
            <udn>mrnSiteId</udn>
            <caption>#getMessage("participant_mrn_site_id")</caption>
            <column>SITE_ID</column>
            <recordUrl>#/object-state-params-resolver?stateName=SitesListItemDetail.Overview&amp;objectName=site&amp;key=id&amp;value={{$value}}</recordUrl>
          </numberField>
          <siteField>
            <name>mrnSiteName</name>
            <udn>mrnSiteName</udn>
            <caption>#getMessage("participant_mrn_site")</caption>
            <column>SITE_ID</column>
            <recordUrl>#/object-state-params-resolver?stateName=SitesListItemDetail.Overview&amp;objectName=site&amp;key=name&amp;value={{$value}}</recordUrl>
          </siteField>
          <textField>
            <name>medicalRecordNumber</name>
            <udn>medicalRecordNumber</udn>
            <caption>#getMessage("participant_mrn_mrn")</caption>
            <column>MEDICAL_RECORD_NUMBER</column>
            <phi>true</phi>
          </textField>
        </row>
      </subForm>
    </row>
    <row>
      <textField>
        <name>barcode</name>
        <udn>barcode</udn>
        <caption>#getMessage("participant_barcode")</caption>
        <column>BARCODE</column>
      </textField>
    </row>
    <row>
      <numberField>
        <name>id</name>
        <udn>id</udn>
        <caption>#getMessage("cpr_id")</caption>
        <column>CPR_ID</column>
        <recordUrl>#/object-state-params-resolver?stateName=ParticipantsListItemDetail.Overview&amp;objectName=collection_protocol_registration&amp;key=id&amp;value={{$value}}</recordUrl>
      </numberField>
    </row>
    <row>
      <datePicker>
        <name>regDate</name>
        <udn>regDate</udn>
        <caption>#getMessage("participant_registration_date")</caption>
        <column>REGISTRATION_DATE</column>
        <format>MM-dd-yyyy/dateOnly</format>
      </datePicker>
    </row>
    <row>
      <textField>
        <name>ppid</name>
        <udn>ppid</udn>
        <caption>#getMessage("participant_ppid")</caption>
        <column>PPID</column>
        <recordUrl>#/object-state-params-resolver?stateName=ParticipantsListItemDetail.Overview&amp;objectName=collection_protocol_registration&amp;key=id&amp;value={{$cprId}}</recordUrl>
      </textField>
    </row>
    <row>
      <siteField>
        <name>site</name>
        <udn>site</udn>
        <caption>#getMessage("participant_reg_site")</caption>
        <column>SITE_ID</column>
        <recordUrl>#/object-state-params-resolver?stateName=SitesListItemDetail.Overview&amp;objectName=site&amp;key=name&amp;value={{$value}}</recordUrl>
      </siteField>
    </row>
    <row>
      <textField>
        <name>externalSubjectId</name>
        <udn>externalSubjectId</udn>
        <caption>#getMessage("participant_external_id")</caption>
        <column>EXTERNAL_SUBJECT_ID</column>
        <recordUrl>#/object-state-params-resolver?stateName=ParticipantsListItemDetail.Overview&amp;objectName=collection_protocol_registration&amp;key=id&amp;value={{$cprId}}</recordUrl>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>creationTime</name>
        <udn>creationTime</udn>
        <caption>#getMessage("common_creation_time")</caption>
        <column>CREATION_TIME</column>
        <format>MM-dd-yyyy HH:mm</format>
      </datePicker>
    </row>
    <row>
      <userField>
        <name>creator</name>
        <udn>creator</udn>
        <caption>#getMessage("common_creator")</caption>
        <column>CREATOR</column>
      </userField>
    </row>
    <row>
      <datePicker>
        <name>updateTime</name>
        <udn>updateTime</udn>
        <caption>#getMessage("common_update_time")</caption>
        <column>UPDATE_TIME</column>
        <format>MM-dd-yyyy HH:mm</format>
      </datePicker>
    </row>
    <row>
      <userField>
        <name>updater</name>
        <udn>updater</udn>
        <caption>#getMessage("common_updater")</caption>
        <column>UPDATER</column>
      </userField>
    </row>
    <row>
      <subForm>
        <name>scgs</name>
        <udn>scgs</udn>
        <caption>#getMessage("participant_visits")</caption>
        <table>CATISSUE_SPECIMEN_COLL_GROUP</table>
        <foreignKey>COLLECTION_PROTOCOL_REG_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <pathLink>true</pathLink>
        <row>
          <subForm>
            <name>specimens</name>
            <udn>specimens</udn>
            <caption>#getMessage("participant_visits_specimens")</caption>
            <table>CATISSUE_SPECIMEN</table>
            <foreignKey>SPECIMEN_COLLECTION_GROUP_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
            <pathLink>true</pathLink>

            <row>
              <subForm>
                <name>specimenOrders</name>
                <udn>specimenOrders</udn>
                <caption>#getMessage("participant_visits_specimens_order_items")</caption>
                <table>OS_ORDER_ITEMS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>
                <row>
                  <subForm>
                    <name>order</name>
                    <udn>order</udn>
                    <caption>#getMessage("participant_visits_specimens_order_items_order")</caption>
                    <table>OS_ORDERS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>ORDER_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>
            
            <row>
              <subForm>
                <name>specimenShipments</name>
                <udn>specimenShipments</udn>
                <caption>#getMessage("specimen_shipment_items")</caption>
                <table>OS_SHIPMENT_SPECIMENS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>
                
                <row>
                  <subForm>
                    <name>shipment</name>
                    <udn>shipment</udn>
                    <caption>#getMessage("specimen_shipment_items_shipment")</caption>
                    <table>OS_SHIPMENTS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>SHIPMENT_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>

            <row>
              <subForm>
                <name>specimenKits</name>
                <udn>specimenKits</udn>
                <caption>#getMessage("specimen_kit_specimens")</caption>
                <table>OS_KIT_SPECIMENS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>

                <row>
                  <subForm>
                    <name>specimenKit</name>
                    <udn>specimenKit</udn>
                    <caption>#getMessage("specimen_kit")</caption>
                    <table>OS_SPECIMEN_KITS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>KIT_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>
          </subForm>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>consentTier</name>
        <udn>consentTier</udn>
        <caption>#getMessage("participant_consent_tier")</caption>
        <table>CONSENT_TIER_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <row>
          <textField>
            <name>consentTierStatement</name>
            <udn>consentTierStatement</udn>
            <caption>#getMessage("participant_consent_tier_statement")</caption>
            <column>STATEMENT</column>
          </textField>

          <textField>
            <name>statementCode</name>
            <udn>statementCode</udn>
            <caption>#getMessage("participant_consent_tier_stmt_code")</caption>
            <column>CODE</column>
          </textField>

          <pvField>
            <name>consentResponseStatement</name>
            <udn>consentResponseStatement</udn>
            <caption>#getMessage("participant_consent_tier_response")</caption>
            <column>RESPONSE_ID</column>
            <attribute>consent_response</attribute>
          </pvField>
        </row>
      </subForm>
    </row>
    <row>
      <textField>
        <name>consentDocumentName</name>
        <udn>consentDocumentName</udn>
        <caption>#getMessage("participant_consent_doc_name")</caption>
        <column>CONSENT_DOCUMENT_NAME</column>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>consentSignDate</name>
        <udn>consentSignDate</udn>
        <caption>#getMessage("participant_consent_sign_date")</caption>
        <column>CONSENT_SIGN_DATE</column>
        <format>MM-dd-yyyy</format>
      </datePicker>
    </row>
    <row>  
      <userField>
        <name>consentWitness</name>
        <udn>consentWitness</udn>
        <caption>#getMessage("participant_consent_witness")</caption>
        <column>CONSENT_WITNESS</column>
      </userField>    
    </row>
    <row>
      <textField>
        <name>consentComments</name>
        <udn>consentComments</udn>
        <caption>#getMessage("participant_consent_comments")</caption>
        <column>CONSENT_COMMENTS</column>
      </textField>
    </row>
    <row>
      <subForm>
        <name>customFields</name>
        <udn>customFields</udn>
        <caption>#getMessage("participant_field_extensions")</caption>
        <table>OS_CPR_CUST_FIELDS</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>extensions</name>
        <udn>extensions</udn>
        <caption>#getMessage("participant_extensions")</caption>
        <table>OS_CPR_EXTN_RECS_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>visitCount</name>
        <udn>visitCount</udn>
        <caption>#getMessage("cpr_visit_count")</caption>
        <table>OS_CPR_VISIT_STATS_VIEW</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <row>
          <numberField>
            <name>completedVisits</name>
            <udn>completedVisits</udn>
            <caption>#getMessage("number_of_visits_completed")</caption>
            <column>VISITS_COMPLETED</column>
          </numberField>
       
          <numberField>
            <name>missedVisits</name>
            <udn>missedVisits</udn>
            <caption>#getMessage("number_of_visits_missed")</caption>
            <column>VISITS_MISSED</column>
          </numberField>

          <numberField>
            <name>notCollectedVisits</name>
            <udn>notCollectedVisits</udn>
            <caption>#getMessage("number_of_visits_not_collected")</caption>
            <column>VISITS_NOT_COLLECTED</column>
          </numberField>
      
          <numberField>
            <name>pendingVisits</name>
            <udn>pendingVisits</udn>
            <caption>#getMessage("number_of_visits_pending")</caption>
            <column>VISITS_PENDING</column>
          </numberField>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>specimenCount</name>
        <udn>specimenCount</udn>
        <caption>#getMessage("cpr_specimen_count")</caption>
        <table>OS_CPR_SPMN_STATS</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <row>
          <numberField>
            <name>collectedSpecimens</name>
            <udn>collectedSpecimens</udn>
            <caption>#getMessage("number_of_specimens_collected")</caption>
            <column>SPECIMENS_COLLECTED</column>
          </numberField>
       
          <numberField>
            <name>missedSpecimens</name>
            <udn>missedSpecimens</udn>
            <caption>#getMessage("number_of_specimens_missed")</caption>
            <column>SPECIMENS_MISSED</column>
          </numberField>

          <numberField>
            <name>notCollectedSpecimens</name>
            <udn>notCollectedSpecimens</udn>
            <caption>#getMessage("number_of_specimens_not_collected")</caption>
            <column>SPECIMENS_NOT_COLLECTED</column>
          </numberField>

          <numberField>
            <name>pendingSpecimens</name>
            <udn>pendingSpecimens</udn>
            <caption>#getMessage("number_of_specimens_pending")</caption>
            <column>SPECIMENS_PENDING</column>
          </numberField>
        </row>
      </subForm>
    </row>

    <row>
      <subForm>
        <name>anticipatedSpmns</name>
        <udn>anticipatedSpmns</udn>
        <caption>#getMessage("cpr_anticipated_spmns")</caption>
        <table>OS_CPR_ANTICIPATED_SPMNS</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <flatten>false</flatten>
        <row>
          <numberField>
            <name>reqId</name>
            <udn>reqId</udn>
            <caption>#getMessage("cpr_as_req_id")</caption>
            <column>REQ_ID</column>
          </numberField>

          <textField>
            <name>eventCode</name>
            <udn>eventCode</udn>
            <caption>#getMessage("cpr_as_event_code")</caption>
            <column>EVENT_CODE</column>
          </textField>

          <textField>
            <name>eventLabel</name>
            <udn>eventLabel</udn>
            <caption>#getMessage("cpr_as_event_label")</caption>
            <column>EVENT_LABEL</column>
          </textField>

          <datePicker>
            <name>eventDate</name>
            <udn>eventDate</udn>
            <caption>#getMessage("cpr_as_event_date")</caption>
            <column>EVENT_DATE</column>
          </datePicker>

          <pvField>
            <name>clinicalStatus</name>
            <udn>clinicalStatus</udn>
            <caption>#getMessage("cpr_as_clinical_status")</caption>
            <column>CLINICAL_STATUS_ID</column>
            <attribute>clinical_status</attribute>
          </pvField>

          <pvField>
            <name>clinicalDiagnosis</name>
            <udn>clinicalDiagnosis</udn>
            <caption>#getMessage("cpr_as_clinical_diagnosis")</caption>
            <column>CLINICAL_DIAGNOSIS_ID</column>
            <attribute>clinical_diagnosis</attribute>
          </pvField>

          <textField>
            <name>reqCode</name>
            <udn>reqCode</udn>
            <caption>#getMessage("cpr_as_req_code")</caption>
            <column>REQ_CODE</column>
          </textField>

          <textField>
            <name>reqName</name>
            <udn>reqName</udn>
            <caption>#getMessage("cpr_as_req_name")</caption>
            <column>REQ_NAME</column>
          </textField>

          <dropDown>
            <name>lineage</name>
            <udn>lineage</udn>
            <caption>#getMessage("cpr_as_lineage")</caption>
            <column>LINEAGE</column>
            <options>
              <option><value>New</value></option>
              <option><value>Derived</value></option>
              <option><value>Aliquot</value></option>
            </options>
          </dropDown>

          <pvField>
            <name>specimenClass</name>
            <udn>specimenClass</udn>
            <caption>#getMessage("cpr_as_class")</caption>
            <column>SPECIMEN_CLASS_ID</column>
            <attribute>specimen_type</attribute>
            <rootValue>true</rootValue>
          </pvField>

          <pvField>
            <name>specimenType</name>
            <udn>specimenType</udn>
            <caption>#getMessage("cpr_as_type")</caption>
            <column>SPECIMEN_TYPE_ID</column>
            <attribute>specimen_type</attribute>
            <leafValue>true</leafValue>
          </pvField>

          <pvField>
            <name>anatomicSite</name>
            <udn>anatomicSite</udn>
            <caption>#getMessage("cpr_as_anatomic_site")</caption>
            <column>ANATOMIC_SITE_ID</column>
            <attribute>anatomic_site</attribute>
            <leafValue>true</leafValue>
          </pvField>

          <pvField>
            <name>laterality</name>
            <udn>laterality</udn>
            <caption>#getMessage("cpr_as_laterality")</caption>
            <column>LATERALITY_ID</column>
            <attribute>laterality</attribute>
          </pvField>

          <numberField>
            <name>quantity</name>
            <udn>quantity</udn>
            <caption>#getMessage("cpr_as_quantity")</caption>
            <column>QUANTITY</column>
            <noOfDigitsAfterDecimal>#getPrecision()</noOfDigitsAfterDecimal>
          </numberField>

          <numberField>
            <name>concentration</name>
            <udn>concentration</udn>
            <caption>#getMessage("cpr_as_concentration")</caption>
            <column>CONCENTRATION</column>
            <noOfDigitsAfterDecimal>#getPrecision()</noOfDigitsAfterDecimal>
          </numberField>

          <pvField>
            <name>pathStatus</name>
            <udn>pathStatus</udn>
            <caption>#getMessage("cpr_as_path_status")</caption>
            <column>PATH_STATUS_ID</column>
            <attribute>pathology_status</attribute>
          </pvField>

          <pvField>
            <name>collectionContainer</name>
            <udn>collectionContainer</udn>
            <caption>#getMessage("cpr_as_coll_container")</caption>
            <column>COLLECTION_CONTAINER_ID</column>
            <attribute>collection_container</attribute>
          </pvField>

          <pvField>
            <name>collectionProcedure</name>
            <udn>collectionProcedure</udn>
            <caption>#getMessage("cpr_as_coll_procedure")</caption>
            <column>COLLECTION_PROCEDURE_ID</column>
            <attribute>collection_procedure</attribute>
          </pvField>
        </row>
      </subForm>
    </row>

    $querySvc.insertCustomQueryForms('cpr')
  </view>
</form>
